{% extends "base.html" %}

{% block content %}
    <h2>ğŸ“… å…±äº«æ—¥è®° (2025å¹´ 10æœˆ - æ¨¡æ‹Ÿ)</h2>
    <p>
        {% if partner_name %}
            åœ¨è¿™é‡Œè®°å½•æ‚¨å’Œ <strong>{{ partner_name }}</strong> çš„å…±åŒå›å¿†ã€‚
            <span class="dot dot-me" style="display: inline-block;"></span> = {{ current_user.username }} (æˆ‘)
            <span class="dot dot-partner" style="display: inline-block; margin-left: 10px;"></span> = {{ partner_name }} (TA)
        {% endif %}
    </p>

    <!-- æ—¥å† -->
    <div class="calendar-grid">
        <!-- æ˜ŸæœŸ -->
        <div class="calendar-header">æ—¥</div>
        <div class="calendar-header">ä¸€</div>
        <div class="calendar-header">äºŒ</div>
        <div class="calendar-header">ä¸‰</div>
        <div class="calendar-header">å››</div>
        <div class="calendar-header">äº”</div>
        <div class="calendar-header">å…­</div>
        
        <!-- æ¨¡æ‹Ÿ 2025-10-01 æ˜¯å‘¨ä¸‰ -->
        <div class="calendar-day other-month"><div class="day-number">28</div></div>
        <div class="calendar-day other-month"><div class="day-number">29</div></div>
        <div class="calendar-day other-month"><div class="day-number">30</div></div>
        
        <!--
          FIX (V4.2):
          ä½¿ç”¨å¾ªç¯åŠ¨æ€ç”Ÿæˆæ‰€æœ‰å¤©æ•° (1-31)
          è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„å¾ªç¯, çœŸå®çš„æ—¥å†éœ€è¦æ›´å¤æ‚çš„é€»è¾‘æ¥å¤„ç†æ¢è¡Œ
          ä½†è¿™ä¸ªè¶³ä»¥æµ‹è¯•åŠŸèƒ½
        -->
        {% for day in range(1, 32) %}
            <!-- æ ¼å¼åŒ–æ—¥æœŸå­—ç¬¦ä¸², e.g., "2025-10-05" (05 ä¿è¯äº†ä¸¤ä½æ•°) -->
            {% set date_str = '2025-10-%02d' | format(day) %}
            {% set data = calendar_data.get(date_str, {'me': False, 'partner': False, 'me_content': '', 'partner_content': ''}) %}
            
            <!--
              FIX (V4.2): ä½¿ç”¨ Data Attributes
              æˆ‘ä»¬ä¸å†å°†å¤æ‚çš„ JSON æ³¨å…¥ onclick å±æ€§.
              æˆ‘ä»¬æŠŠæ•°æ®å®‰å…¨åœ°å­˜å‚¨åœ¨ data-* å±æ€§ä¸­.
            -->
            <div class="calendar-day" 
                 data-date="{{ date_str }}"
                 data-me="{{ 'true' if data.me else 'false' }}"
                 data-partner="{{ 'true' if data.partner else 'false' }}"
                 data-me-content="{{ data.me_content }}"
                 data-partner-content="{{ data.partner_content }}"
                 onclick="openModal(this)"> <!-- onclick ç°åœ¨åªä¼ é€’å…ƒç´ æœ¬èº« -->
                
                <div class="day-number">{{ day }}</div>
                <div class="entry-dots">
                    {% if data.me %}<span class="dot dot-me"></span>{% endif %}
                    {% if data.partner %}<span class="dot dot-partner"></span>{% endif %}
                </div>
            </div>
        {% endfor %}
        
        <!-- ä¸‹ä¸ªæœˆçš„ (æ¨¡æ‹Ÿ) -->
        <div class="calendar-day other-month"><div class="day-number">1</div></div>
    </div>

    <!--
      FIX (V4.2):
      è¿™ä¸ªè„šæœ¬å—ç°åœ¨åªåšä¸€ä»¶äº‹:
      æŠŠ app.py ä¼ æ¥çš„ partner_name å­˜å‚¨åˆ° <body> æ ‡ç­¾ä¸Š,
      è¿™æ · base.html ä¸­çš„ JS å°±å¯ä»¥è¯»å–å®ƒ.
    -->
    <script>
        document.body.dataset.partnerName = "{{ partner_name }}";
    </script>
{% endblock %}